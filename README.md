# RISC

RISC stands for Research Interactive Services and Collaboration, a Kubernetes based platorm based on an Openstack cloud, on top of which multiple applications can be run and maintained with enjoying the flexibility, resilliance, and fault tolerance.  RISC also features SSO (by connecting with a privte IdP or public ones such as Google/Github Auth), auto-mapping of different services, and potentially auto-scaling of the underlying cluster. 

The aim of RISC project is to provide the convenience of using different research-oriented applications for researchers, as well as of the rapid deployment of the backend infrastructure for system admins. 

## Main components

### 1. A Kubernetes cluster, generated by kubeadm
It includes the following core-components:
* Kubernetes controller-manager/apiserver/scheduler/etcd/proxy/coredns/etc
* Openstack-cloud-controller
* Cinder-CSI
* Cephfs-CSI
* Manila-CSI
* Weave-CNI
* Worker nodeplugins

### 2. PureLB, Load-balancer
* An Allocator
* A lbnodeagent for each worker node

### 3. Ambassador, Ingress-controller and API-gateway
* Ingress-controller, edge-stack
* API-gateway, emissary
* Host/Listener/Mapping
* OIDC adaptor (Google and Alliance IdPs)

### 4. CVMFS-CSI
* A dedicated CVMFS deployment/daemonset to provide CVMFS software repos to multiple applications.

### 5. Cert-Manager
* Certificate tool

### 6. Applications
* Jupyterhub-k8s
* Overleaf-k8s
* Mattermost-k8s

Note: More applications can be added to this platform using the same approach shown in `setup_fullchain.sh`. 

## To deploy (single-master-single-worker mode)
### 1. System requirements
The code is verified on CentOS 7 however it can be run on most Linux distributions with a bit tweaks. An operating system with above 8 CPU cores, 16GB RAM and 100GB disk space is recommended. Minimum requirements can be at 2 vCPUs, 8GB RAM and 50GB disk space.  
### 2. Hosts
Launch two VMs on an Openstack-based cloud with the above requirements, one will be the master node and the other will be a worker node.   
### 3. Cloud CA certificate
Download the CA certificate of the Openstack cloud (from the browser) and place it in /etc/ssl/certs (e.g. Arbutus CA cert can be found at auth/ca.pem.arbutus)
### 3. Cloud config file 
Create a cloud-config file by following the template at auth/cloud-config.
### 4. Kictstart
Now, simply run the automation script (`setup_fullchain.sh`) on the master node it will automatically create the control plane and set up the worker and then deploy all the above components on both nodes. 
### 5. Grow it
More worker nodes can be easily added to the cluster and will be automatically deployed/configured, by runnig the following commands:
```
export KUBEADM_JOIN_COMMAND=`kubeadm token create --print-join-command`
ssh $WORKER_HOSTNAME $KUBEADM_JOIN_COMMAND
```

## Author and contact
erming.pei@westdri.ca

